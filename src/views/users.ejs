<div
  class="flex-1 min-h-0 bg-zinc-50 dark:bg-zinc-900 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800 scrollbar-track-transparent"
>
  <div class="max-w-3xl mx-auto p-4 sm:p-6">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold">Users Management</h1>
      <p class="text-sm sm:text-base text-zinc-500 mt-1">
        Manage user accounts and storage
      </p>
    </div>

    <!-- Stats Cards -->
    <div class="flex items-center gap-4 mb-6">
      <div
        class="flex-1 bg-white dark:bg-zinc-800/50 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-800 p-4"
      >
        <p class="text-sm text-zinc-500">Total Users</p>
        <p class="text-2xl font-bold mt-1"><%= users.length || 0 %></p>
      </div>

      <div
        class="flex-1 bg-white dark:bg-zinc-800/50 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-800 p-4"
      >
        <p class="text-sm text-zinc-500">Total Storage Used</p>
        <p class="text-2xl font-bold mt-1">
          <%= formatFileSize(users.reduce((a, c)=> a + c.storageUsed, 0)) %>
        </p>
      </div>
    </div>

    <!-- Users Table -->
    <div
      class="bg-white dark:bg-zinc-800/50 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-800 overflow-hidden"
    >
      <!-- Desktop Table -->
      <div
        class="hidden md:block overflow-x-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800 scrollbar-track-transparent"
      >
        <table class="w-full">
          <thead
            class="bg-zinc-50 dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800"
          >
            <tr>
              <th
                class="text-left px-6 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider"
              >
                User
              </th>
              <th
                class="text-left px-6 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider"
              >
                Storage
              </th>
              <th
                class="text-left px-6 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider"
              >
                Files
              </th>
              <th
                class="text-left px-6 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider"
              >
                Joined
              </th>
              <th
                class="text-right px-6 py-3 text-xs font-medium text-zinc-500 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>

          <tbody
            class="divide-y divide-zinc-200 dark:divide-zinc-800 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-800 scrollbar-track-transparent"
          >
            <% users.map(user => { %>
            <!-- User Row -->
            <tr class="hover:bg-zinc-50 dark:hover:bg-zinc-800/25">
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="flex-shrink-0">
                    <div
                      role="img"
                      aria-label="User avatar with initials A"
                      class="size-10 rounded-full bg-gradient-to-br from-teal-400 to-emerald-600 flex items-center justify-center text-zinc-50 text-xl font-medium"
                    >
                      <%= formatAvatar(user) %>
                    </div>
                  </div>
                  <div>
                    <p class="font-medium">
                      <%= user.name || user.email.split('@')[0] %>
                    </p>
                    <p class="text-sm text-zinc-500"><%= user.email %></p>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div>
                  <p class="text-sm font-medium">
                    <span><%= formatFileSize(user.storageUsed) %></span> / 50 MB
                  </p>
                  <div
                    class="w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-1 mt-2 mb-4"
                    role="progressbar"
                    aria-valuenow="<%= user.storagePercentage %>%"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    aria-label="Storage usage: <%= user.storagePercentage %>% of 50 used"
                  >
                    <div
                      class="bg-gradient-to-r from-sky-400 to-purple-700 h-1 rounded-full transition-all duration-500"
                      style="width: <%= user.storagePercentage %>%"
                    ></div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <p class="text-sm"><%= user._count.files %></p>
              </td>
              <td class="px-6 py-4">
                <p class="text-sm">
                  <%= formatDate(user.createdAt, 'LLL yyyy') %>
                </p>
              </td>

              <td class="px-6 py-4 text-right">
                <a
                  href="/users/<%= user.id %>"
                  class="text-lime-600 hover:text-lime-500 text-sm font-medium mr-3"
                >
                  View
                </a>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Mobile Cards -->
      <div class="md:hidden divide-y divide-zinc-200">
        <!-- User Card 1 -->
        <% users.map(user => { %>
        <div class="p-4">
          <!-- Avatar -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 text-xl rounded-full bg-gradient-to-br from-teal-400 to-emerald-600 flex items-center justify-center text-white font-semibold"
              >
                <%= formatAvatar(user) %>
              </div>
              <div>
                <p class="font-medium">
                  <%= user.name || user.email.split('@')[0] %>
                </p>
                <p class="text-sm text-zinc-500"><%= user.email %></p>
              </div>
            </div>
          </div>

          <!-- Storage -->
          <div class="space-y-2 mb-3">
            <div>
              <p class="text-xs text-zinc-500">Storage</p>
              <p class="text-sm font-medium">
                <span><%= formatFileSize(user.storageUsed) %></span> / 50 MB
              </p>
              <div
                class="w-full bg-zinc-200 dark:bg-zinc-800 rounded-full h-1 mt-2 mb-4"
                role="progressbar"
                aria-valuenow="80%"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-label="Storage usage: 80% of 50 used"
              >
                <div
                  class="bg-gradient-to-r from-sky-400 to-purple-700 h-1 rounded-full transition-all duration-500"
                  style="width: 80%"
                ></div>
              </div>
            </div>

            <!-- Basic info -->
            <div class="flex justify-between">
              <div>
                <p class="text-xs text-zinc-500">Files</p>
                <p class="text-sm font-medium"><%= user._count.files %></p>
              </div>
              <div>
                <p class="text-xs text-zinc-500">Joined</p>
                <p class="text-sm font-medium">
                  <%= formatDate(user.createdAt, 'LLL yyyy') %>
                </p>
              </div>
            </div>
          </div>
          <div class="flex gap-2">
            <button
              class="flex-1 px-3 py-2 text-sm font-medium text-lime-600 dark:text-lime-500 bg-lime-100 dark:bg-lime-950/50 border border-lime-200 dark:border-lime-900/25 rounded-lg hover:bg-lime-200 dark:hover:bg-lime-900/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-zinc-900"
            >
              <a
                href="/users/<%= user.id %>"
                class="text-lime-600 hover:text-lime-500 text-sm font-medium mr-3"
              >
                View Profile
              </a>
            </button>
          </div>
        </div>
        <% }) %>
      </div>

      <!-- footer -->
      <div
        class="border-t border-zinc-200 dark:border-zinc-800 px-4 py-3 sm:px-6"
      >
        <div class="flex items-center justify-center">
          <p class="text-sm text-zinc-400 dark:text-zinc-600">
            Total
            <span class="font-medium"><%= users.length || 0 %></span> users
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
